local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- إنشاء ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")

-- إنشاء ScrollFrame مخفي أولًا
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(0, 300, 0, 400)
scrollFrame.Position = UDim2.new(0, 50, 0, 50)
scrollFrame.CanvasSize = UDim2.new(0,0,0,0)
scrollFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
scrollFrame.Visible = false -- مخفي
scrollFrame.Parent = screenGui

local uiListLayout = Instance.new("UIListLayout")
uiListLayout.Parent = scrollFrame
uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- زر خفي لتفعيل ScrollFrame
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 50, 0, 50)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundTransparency = 1
toggleButton.Text = "" -- مخفي
toggleButton.Parent = screenGui

toggleButton.MouseButton1Click:Connect(function()
    scrollFrame.Visible = not scrollFrame.Visible
end)

-- دالة تظهر السكربتات داخل ScrollFrame
local function showScripts(part)
    -- مسح القديم
    for _, child in pairs(scrollFrame:GetChildren()) do
        if child:IsA("TextLabel") then
            child:Destroy()
        end
    end

    -- إيجاد السكربتات داخل البارت
    for _, obj in pairs(part:GetDescendants()) do
        if obj:IsA("Script") or obj:IsA("LocalScript") or obj:IsA("ModuleScript") then
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1,0,0,25)
            label.BackgroundTransparency = 1
            label.TextColor3 = Color3.new(1,1,1)
            label.Text = obj.Name
            label.TextScaled = false
            label.TextSize = 14
            label.Parent = scrollFrame
        end
    end

    scrollFrame.CanvasSize = UDim2.new(0,0,0,uiListLayout.AbsoluteContentSize.Y)
end

-- دالة تسوي اسم فوق كل بارت (ما على جسد اللاعب)
local function showName(obj)
    if obj:IsA("BasePart") and not obj:IsDescendantOf(player.Character) then
        local billboard = Instance.new("BillboardGui")
        billboard.Size = UDim2.new(0, 100, 0, 50)
        billboard.Adornee = obj
        billboard.AlwaysOnTop = true

        local text = Instance.new("TextLabel")
        text.Size = UDim2.new(1,0,1,0)
        text.BackgroundTransparency = 1
        text.Text = obj.Name
        text.TextColor3 = Color3.new(1,1,1)
        text.TextScaled = false
        text.TextSize = 14
        text.Parent = billboard

        billboard.Parent = obj
    end
end

-- تطبيق على كل البارتات الموجودة أولًا
for _, obj in pairs(Workspace:GetDescendants()) do
    showName(obj)
end

-- مراقبة أي بارت جديد يضاف لاحقًا
Workspace.DescendantAdded:Connect(function(obj)
    showName(obj)
end)

-- كشف الضغط للجوال فقط
UserInputService.TouchStarted:Connect(function(touch, processed)
    if processed then return end
    local target = workspace:FindPartOnRayWithIgnoreList(
        workspace.CurrentCamera:ScreenPointToRay(touch.Position.X, touch.Position.Y),
        {player.Character}
    )
    if target and target:IsA("BasePart") then
        showScripts(target)
        scrollFrame.Visible = true -- يظهر ScrollFrame تلقائي عند الضغط
    end
end)
