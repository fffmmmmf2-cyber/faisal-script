-- ServerScript كامل
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- إنشاء RemoteEvent داخلي
local followEvent = Instance.new("RemoteEvent")
followEvent.Name = "FollowEvent"
followEvent.Parent = ReplicatedStorage

-- عند دخول أي لاعب، نضيف له GUI
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        local playerGui = player:WaitForChild("PlayerGui")
        local screenGui = Instance.new("ScreenGui", playerGui)
        screenGui.Name = "FollowGUI"

        local mainFrame = Instance.new("Frame")
        mainFrame.Size = UDim2.new(0, 250, 0, 200)
        mainFrame.Position = UDim2.new(0.5, -125, 0.5, -100)
        mainFrame.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        mainFrame.BackgroundTransparency = 0.3
        mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
        mainFrame.Parent = screenGui

        -- جعل الفريم قابل للسحب
        local dragging, dragInput, dragStart, startPos
        local function update(input)
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end

        mainFrame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true
                dragStart = input.Position
                startPos = mainFrame.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end)

        mainFrame.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                dragInput = input
            end
        end)

        game:GetService("UserInputService").InputChanged:Connect(function(input)
            if input == dragInput and dragging then
                update(input)
            end
        end)

        -- TextBox
        local nameBox = Instance.new("TextBox", mainFrame)
        nameBox.Size = UDim2.new(0, 200, 0, 40)
        nameBox.Position = UDim2.new(0.5, -100, 0, 10)
        nameBox.PlaceholderText = "اكتب الاسم هنا"
        nameBox.TextScaled = true

        -- صورة البروفايل
        local profileImage = Instance.new("ImageLabel", mainFrame)
        profileImage.Size = UDim2.new(0, 80, 0, 80)
        profileImage.Position = UDim2.new(0.5, -40, 0, 60)
        profileImage.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        profileImage.ScaleType = Enum.ScaleType.Fit

        -- زر برتقالي
        local followButton = Instance.new("TextButton", mainFrame)
        followButton.Size = UDim2.new(0, 120, 0, 40)
        followButton.Position = UDim2.new(0.5, -60, 0, 150)
        followButton.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
        followButton.Text = "تابعه"
        followButton.TextScaled = true

        -- تحديث صورة اللاعب
        nameBox.Changed:Connect(function()
            local targetName = nameBox.Text
            local targetPlayer = Players:FindFirstChild(targetName)
            if targetPlayer then
                local content, ready = Players:GetUserThumbnailAsync(targetPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
                profileImage.Image = content
            else
                profileImage.Image = ""
            end
        end)

        -- عند الضغط نرسل للسيرفر (هو نفسه السيرفر هنا)
        followButton.MouseButton1Click:Connect(function()
            local targetName = nameBox.Text
            local targetPlayer = Players:FindFirstChild(targetName)
            if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                if myHRP then
                    targetPlayer.Character.HumanoidRootPart.CFrame = myHRP.CFrame * CFrame.new(0, 0, -3)
                end
            end
        end)
    end)
end)
