-- LocalScript
local player = game.Players.LocalPlayer
local players = game.Players
local RunService = game:GetService("RunService")

local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "ChaseGui"

-- ======== GUI الرئيسي ========
local Frame = Instance.new("Frame", gui)
Frame.Size = UDim2.new(0,250,0,300)
Frame.Position = UDim2.new(0.5,-125,0.5,-150)
Frame.BackgroundColor3 = Color3.fromRGB(40,40,40)
Frame.Active = true
Frame.Draggable = true

-- زر إظهار/إخفاء الفريم
local ToggleBtn = Instance.new("TextButton", gui)
ToggleBtn.Size = UDim2.new(0,30,0,30)
ToggleBtn.Position = UDim2.new(0,10,0.5,-15)
ToggleBtn.Text = "+"
ToggleBtn.Font = Enum.Font.SourceSansBold
ToggleBtn.TextSize = 20
ToggleBtn.TextColor3 = Color3.new(1,1,1)
ToggleBtn.BackgroundColor3 = Color3.fromHSV(0,1,1)
ToggleBtn.AutoButtonColor = false

-- رينبو للزر
spawn(function()
	local hue = 0
	while true do
		hue = (hue + 0.01) % 1
		ToggleBtn.BackgroundColor3 = Color3.fromHSV(hue,1,1)
		wait(0.03)
	end
end)

-- Frame محتويات
local MatchTypeBtn = Instance.new("TextButton", Frame)
MatchTypeBtn.Size = UDim2.new(1,0,0,50)
MatchTypeBtn.Position = UDim2.new(0,0,0,10)
MatchTypeBtn.Text = "اختر نوع المباراة"
MatchTypeBtn.Font = Enum.Font.SourceSansBold
MatchTypeBtn.TextSize = 20
MatchTypeBtn.TextColor3 = Color3.new(1,1,1)
MatchTypeBtn.BackgroundColor3 = Color3.fromRGB(100,100,200)

local SelectionFrame = Instance.new("ScrollingFrame", Frame)
SelectionFrame.Size = UDim2.new(1,0,0,200)
SelectionFrame.Position = UDim2.new(0,0,0,70)
SelectionFrame.CanvasSize = UDim2.new(0,0,0,0)
SelectionFrame.BackgroundColor3 = Color3.fromRGB(60,60,60)
SelectionFrame.Visible = false

local UIListLayout = Instance.new("UIListLayout", SelectionFrame)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0,5)

local ActionBtn = Instance.new("TextButton", Frame)
ActionBtn.Size = UDim2.new(1,0,0,50)
ActionBtn.Position = UDim2.new(0,0,1,-60)
ActionBtn.Text = "اعطيه القنبلة"
ActionBtn.Font = Enum.Font.SourceSansBold
ActionBtn.TextSize = 20
ActionBtn.TextColor3 = Color3.new(1,1,1)
ActionBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)

-- متغيرات
local selectedPlayers = {}
local maxSelection = 1
local targetQueue = {}
local isRunning = false
local playerButtons = {}

-- أسماء اللاعبين
local function createBillboard(p)
	if not p.Character then return end
	if p.Character:FindFirstChild("NameTag") then p.Character.NameTag:Destroy() end
	local bill = Instance.new("BillboardGui", p.Character)
	bill.Name = "NameTag"
	bill.Size = UDim2.new(0,100,0,50)
	bill.AlwaysOnTop = true
	bill.StudsOffset = Vector3.new(0,3,0)
	local label = Instance.new("TextLabel", bill)
	label.Size = UDim2.new(1,0,1,0)
	label.Text = p.DisplayName
	label.TextColor3 = Color3.new(1,0,0)
	label.BackgroundTransparency = 1
	label.Font = Enum.Font.SourceSansBold
	label.TextScaled = true
end

for _, p in pairs(players:GetPlayers()) do createBillboard(p) end
players.PlayerAdded:Connect(createBillboard)

-- اختيار نوع المباراة
MatchTypeBtn.MouseButton1Click:Connect(function()
	local types = {"1v1","2v2","3v3","4v4"}
	SelectionFrame.Visible = false
	SelectionFrame:ClearAllChildren()
	for i, t in ipairs(types) do
		local btn = Instance.new("TextButton", SelectionFrame)
		btn.Size = UDim2.new(1,0,0,40)
		btn.Position = UDim2.new(0,0,0,(i-1)*45)
		btn.Text = t
		btn.Font = Enum.Font.SourceSansBold
		btn.TextSize = 20
		btn.TextColor3 = Color3.new(1,1,1)
		btn.BackgroundColor3 = Color3.fromRGB(80,80,150)

		btn.MouseButton1Click:Connect(function()
			local num = tonumber(t:sub(1,1))
			maxSelection = num
			selectedPlayers = {}
			-- مسح أزرار اللاعبين القديمة
			for _, b in pairs(playerButtons) do b:Destroy() end
			playerButtons = {}

			SelectionFrame:ClearAllChildren()
			local layout = Instance.new("UIListLayout", SelectionFrame)
			layout.SortOrder = Enum.SortOrder.LayoutOrder
			layout.Padding = UDim.new(0,5)

			for _, p in pairs(players:GetPlayers()) do
				if p ~= player then
					local plBtn = Instance.new("TextButton", SelectionFrame)
					plBtn.Size = UDim2.new(1,0,0,40)
					plBtn.Text = p.DisplayName
					plBtn.Font = Enum.Font.SourceSansBold
					plBtn.TextSize = 18
					plBtn.TextColor3 = Color3.new(1,1,1)
					plBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
					plBtn.MouseButton1Click:Connect(function()
						if #selectedPlayers < maxSelection and not table.find(selectedPlayers,p) then
							table.insert(selectedPlayers,p)
							plBtn.BackgroundColor3 = Color3.fromRGB(0,150,0)

							-- إنشاء زر صغير منسوخ للاعب
							local cloneBtn = ActionBtn:Clone()
							cloneBtn.Size = UDim2.new(0,120,0,30) -- صغير
							cloneBtn.Parent = gui
							cloneBtn.Name = "PlayerBtn_"..p.UserId
							cloneBtn.Position = UDim2.new(0,10,0,50 + (#playerButtons)*40)
							cloneBtn.Visible = not Frame.Visible
							cloneBtn.Text = p.DisplayName
							table.insert(playerButtons, cloneBtn)

							cloneBtn.MouseButton1Click:Connect(function()
								if not p.Parent or not p.Character then
									cloneBtn.Visible = false
									return
								end
								local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
								local targetHRP = p.Character and p.Character:FindFirstChild("HumanoidRootPart")
								if hrp and targetHRP then
									hrp.CFrame = targetHRP.CFrame
								end
							end)
						end
					end)
				end
			end
			SelectionFrame.CanvasSize = UDim2.new(0,0,0,#players:GetPlayers()*45)
			SelectionFrame.Visible = true
		end)
	end
	SelectionFrame.Visible = true
end)

-- زر + لإظهار/إخفاء الفريم وأزرار اللاعبين المنسوخة
ToggleBtn.MouseButton1Click:Connect(function()
	Frame.Visible = not Frame.Visible
	for _, btn in pairs(playerButtons) do
		btn.Visible = not Frame.Visible
	end
end)
