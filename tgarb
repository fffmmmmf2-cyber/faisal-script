-- LocalScript في StarterPlayerScripts

local player = game.Players.LocalPlayer
local players = game.Players
local RunService = game:GetService("RunService")

local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "ChaseGui"

-- الفريم الرئيسي
local Frame = Instance.new("Frame", gui)
Frame.Size = UDim2.new(0,200,0,150)
Frame.Position = UDim2.new(0,20,0.5,-75)
Frame.BackgroundColor3 = Color3.fromRGB(40,40,40)

-- زر اختيار اللاعب التالي
local NextPlayerBtn = Instance.new("TextButton", Frame)
NextPlayerBtn.Size = UDim2.new(1,0,0,50)
NextPlayerBtn.Position = UDim2.new(0,0,0,10)
NextPlayerBtn.Text = "التالي"
NextPlayerBtn.Font = Enum.Font.SourceSansBold
NextPlayerBtn.TextSize = 20
NextPlayerBtn.TextColor3 = Color3.new(1,1,1)
NextPlayerBtn.BackgroundColor3 = Color3.fromRGB(100,100,200)

-- زر الانتقال خلف اللاعب مع الدوران
local ActionBtn = Instance.new("TextButton", Frame)
ActionBtn.Size = UDim2.new(1,0,0,50)
ActionBtn.Position = UDim2.new(0,0,0,70)
ActionBtn.Text = "اعطيه القنبلة"
ActionBtn.Font = Enum.Font.SourceSansBold
ActionBtn.TextSize = 20
ActionBtn.TextColor3 = Color3.new(1,1,1)
ActionBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)

local playerList = {}
local index = 0
local targetPlayer = nil

-- تحديث قائمة اللاعبين
local function updatePlayers()
	playerList = {}
	for _, p in pairs(players:GetPlayers()) do
		if p ~= player then
			table.insert(playerList, p)
		end
	end
	if targetPlayer == nil or not targetPlayer.Parent then
		if #playerList > 0 then
			index = (index % #playerList) + 1
			targetPlayer = playerList[index]
			NextPlayerBtn.Text = "التالي: "..targetPlayer.DisplayName
		else
			targetPlayer = nil
			NextPlayerBtn.Text = "لا يوجد لاعب"
		end
	end
end

updatePlayers()
players.PlayerAdded:Connect(updatePlayers)
players.PlayerRemoving:Connect(function(p)
	if p == targetPlayer then
		updatePlayers()
	end
end)

-- تغيير اللاعب عند الضغط على الزر
NextPlayerBtn.MouseButton1Click:Connect(function()
	if #playerList > 0 then
		index = (index % #playerList) + 1
		targetPlayer = playerList[index]
		NextPlayerBtn.Text = "التالي: "..targetPlayer.DisplayName
	end
end)

-- الانتقال خلف اللاعب لمدة 1 ثانية مع دوران مرتين والعودة لمكانك الأصلي
ActionBtn.MouseButton1Click:Connect(function()
	if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
		local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
		local targetHRP = targetPlayer.Character.HumanoidRootPart
		if hrp then
			local originalCFrame = hrp.CFrame
			local duration = 1 -- ثانية
			local spins = 2 -- دورتين كاملتين
			local startTime = tick()
			local distanceBehind = 1 -- ستود خلف اللاعب

			local conn
			conn = RunService.RenderStepped:Connect(function()
				local elapsed = tick() - startTime
				if elapsed > duration then
					conn:Disconnect()
					hrp.CFrame = originalCFrame -- ارجع لمكانك الأصلي
					return
				end
				-- لاصق خلف اللاعب بشكل طبيعي
				local behindPos = targetHRP.Position - targetHRP.CFrame.LookVector * distanceBehind
				local lookAt = targetHRP.Position
				hrp.CFrame = CFrame.new(behindPos, lookAt)
				-- دوران الجسم حول Y axis
				local angle = math.rad(360 * spins * (elapsed / duration))
				hrp.CFrame = CFrame.new(behindPos) * CFrame.Angles(0, angle, 0)
			end)
		end
	end
end)
