local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- واجهة
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.ResetOnSpawn = false

-- زر إظهار/إخفاء
local ToggleBtn = Instance.new("TextButton", ScreenGui)
ToggleBtn.Size = UDim2.new(0, 35, 0, 35)
ToggleBtn.Position = UDim2.new(0, 10, 0.5, -20)
ToggleBtn.Text = "+"
ToggleBtn.TextScaled = true
ToggleBtn.BackgroundColor3 = Color3.fromRGB(255,0,255)

-- الفريم الأساسي
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 250, 0, 300)
MainFrame.Position = UDim2.new(0.5, -125, 0.5, -150)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Visible = false

-- ScrollFrame
local PlayerList = Instance.new("ScrollingFrame", MainFrame)
PlayerList.Size = UDim2.new(1, -10, 1, -10)
PlayerList.Position = UDim2.new(0, 5, 0, 5)
PlayerList.CanvasSize = UDim2.new(0,0,0,0)
PlayerList.ScrollBarThickness = 6

local UIList = Instance.new("UIListLayout", PlayerList)
UIList.Padding = UDim.new(0, 4)

-- أزرار اللاعبين المختارين
local SelectedPlayers = {}
local TeleportButtons = {}

-- تحديث القائمة
local function CreatePlayerButton(plr)
	local Btn = Instance.new("TextButton")
	Btn.Size = UDim2.new(1, -5, 0, 30)
	Btn.Text = plr.DisplayName
	Btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
	Btn.TextColor3 = Color3.fromRGB(255,255,255)
	Btn.TextScaled = true

	Btn.MouseButton1Click:Connect(function()
		if not SelectedPlayers[plr] then
			SelectedPlayers[plr] = true
			print("اخترت: "..plr.DisplayName)
		end
	end)

	return Btn
end

local function UpdateList()
	PlayerList:ClearAllChildren()
	UIList.Parent = PlayerList
	for _,plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			local Btn = CreatePlayerButton(plr)
			Btn.Parent = PlayerList
		end
	end
	PlayerList.CanvasSize = UDim2.new(0,0,0,#Players:GetPlayers()*34)
end

Players.PlayerAdded:Connect(UpdateList)
Players.PlayerRemoving:Connect(function(plr)
	SelectedPlayers[plr] = nil
	if TeleportButtons[plr] then
		TeleportButtons[plr]:Destroy()
		TeleportButtons[plr] = nil
	end
	UpdateList()
end)

UpdateList()

-- وظيفة النقل + الدوران
local function TeleportToPlayer(plr)
	if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
		local targetHRP = plr.Character.HumanoidRootPart
		local myHRP = LocalPlayer.Character.HumanoidRootPart

		-- ينقلك قدام اللاعب
		myHRP.CFrame = targetHRP.CFrame * CFrame.new(0,0,-5)

		-- يخليك مواجه له
		myHRP.CFrame = CFrame.new(myHRP.Position, targetHRP.Position)
	end
end

-- توليد الأزرار المنسوخة
local function RefreshTeleportButtons()
	-- مسح القديم
	for _,btn in pairs(TeleportButtons) do
		btn:Destroy()
	end
	TeleportButtons = {}

	local yPos = 0.4
	for plr,_ in pairs(SelectedPlayers) do
		if plr.Parent == Players then
			local Btn = Instance.new("TextButton", ScreenGui)
			Btn.Size = UDim2.new(0, 80, 0, 25)
			Btn.Position = UDim2.new(0, 60, yPos, 0)
			Btn.Text = plr.DisplayName
			Btn.TextScaled = true
			Btn.BackgroundColor3 = Color3.fromRGB(100,0,200)
			Btn.Visible = not MainFrame.Visible

			Btn.MouseButton1Click:Connect(function()
				TeleportToPlayer(plr)
			end)

			TeleportButtons[plr] = Btn
			yPos = yPos + 0.07
		end
	end
end

-- زر الإخفاء والإظهار
ToggleBtn.MouseButton1Click:Connect(function()
	MainFrame.Visible = not MainFrame.Visible
	RefreshTeleportButtons()
end)

-- كل ثانيه يحدث الأزرار
while true do
	RefreshTeleportButtons()
	task.wait(1)
end) 
