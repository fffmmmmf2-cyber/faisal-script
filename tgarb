-- LocalScript: Faisal Local Tools (100% Local, no server changes)
-- ضع هذا السكربت في StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ======= إعداد GUI =======
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FaisalToolsGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local container = Instance.new("Frame")
container.Name = "FaisalContainer"
container.Size = UDim2.new(0,180,0,110)
container.Position = UDim2.new(1,-190,1,-120)
container.BackgroundTransparency = 0.6
container.BackgroundColor3 = Color3.fromRGB(0,0,0)
container.BorderSizePixel = 0
container.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,22)
title.Position = UDim2.new(0,0,0,0)
title.BackgroundTransparency = 1
title.Text = "created by faisal"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextScaled = true
title.Font = Enum.Font.SourceSansBold
title.Parent = container

local function makeToggle(y,text)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-10,0,26)
    btn.Position = UDim2.new(0,5,0,y)
    btn.BackgroundTransparency = 0.4
    btn.BackgroundColor3 = Color3.fromRGB(20,20,20)
    btn.BorderSizePixel = 0
    btn.Text = text.." : OFF"
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.TextScaled = true
    btn.Font = Enum.Font.SourceSans
    btn.Parent = container
    return btn
end

local espBtn = makeToggle(0.28, "player ESP")
local aimBtn = makeToggle(0.60, "aimbot")
local healthBtn = makeToggle(0.92, "health viewer")

local ESP_ENABLED = false
local AIM_ENABLED = false
local HEALTH_ENABLED = false

local function toggleButton(btn, state, label)
    if state then
        btn.Text = label.." : ON"
    else
        btn.Text = label.." : OFF"
    end
end

-- ======= وظائف ESP =======
local function createBillboard(player)
    if not player.Character then return end
    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not hrp then return end

    if player.Character:FindFirstChild("EnemyBillboard") then
        player.Character.EnemyBillboard:Destroy()
    end

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "EnemyBillboard"
    billboard.Adornee = hrp
    billboard.Size = UDim2.new(0,150,0,40)
    billboard.StudsOffset = Vector3.new(0,3,0)
    billboard.AlwaysOnTop = true
    billboard.Parent = player.Character

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1,0,0.5,0)
    nameLabel.Position = UDim2.new(0,0,0,0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.TextColor3 = Color3.fromRGB(255,0,0)
    nameLabel.TextScaled = true
    nameLabel.Parent = billboard

    local healthFrame = Instance.new("Frame")
    healthFrame.Size = UDim2.new(1,0,0.3,0)
    healthFrame.Position = UDim2.new(0,0,0.6,0)
    healthFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
    healthFrame.BorderSizePixel = 0
    healthFrame.Parent = billboard

    local healthBar = Instance.new("Frame")
    healthBar.Name = "FaisalHealthBar"
    healthBar.Size = UDim2.new(1,0,1,0)
    healthBar.BackgroundColor3 = Color3.fromRGB(0,255,0)
    healthBar.BorderSizePixel = 0
    healthBar.Parent = healthFrame

    humanoid:GetPropertyChangedSignal("Health"):Connect(function()
        healthBar.Size = UDim2.new(math.clamp(humanoid.Health / (humanoid.MaxHealth > 0 and humanoid.MaxHealth or 1),0,1),0,1,0)
    end)
end

local function createHighlight(player)
    if not player.Character then return end
    if player.Character:FindFirstChild("EnemyHighlight") then
        player.Character.EnemyHighlight:Destroy()
    end
    local highlight = Instance.new("Highlight")
    highlight.Name = "EnemyHighlight"
    highlight.Adornee = player.Character
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillColor = Color3.fromRGB(255,0,0)
    highlight.FillTransparency = 0
    highlight.OutlineTransparency = 0.7
    highlight.Parent = player.Character
end

-- Health viewer
local function createHealthNumber(player)
    if not player.Character then return end
    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not hrp then return end

    if player.Character:FindFirstChild("FaisalHealthNumber") then
        player.Character.FaisalHealthNumber:Destroy()
    end

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "FaisalHealthNumber"
    billboard.Adornee = hrp
    billboard.Size = UDim2.new(0,80,0,22)
    billboard.StudsOffset = Vector3.new(0,2,0)
    billboard.AlwaysOnTop = true
    billboard.Parent = player.Character

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.TextScaled = true
    label.Font = Enum.Font.SourceSansBold
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Parent = billboard

    spawn(function()
        while HEALTH_ENABLED and humanoid.Parent do
            if humanoid.Health <= 0 then
                label.Visible = false
            else
                label.Visible = true
                label.Text = string.format("%d / %d", math.floor(humanoid.Health), math.floor(humanoid.MaxHealth))
            end
            wait(0.05)
        end
        if billboard and billboard.Parent then billboard:Destroy() end
    end)
end

-- Apply to player
local function applyPlayer(player)
    if player == LocalPlayer then return end
    local function onChar(char)
        if ESP_ENABLED then
            createHighlight(player)
            createBillboard(player)
        end
        if HEALTH_ENABLED then
            createHealthNumber(player)
        end
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.Died:Connect(function()
                if char:FindFirstChild("FaisalHealthNumber") then char.FaisalHealthNumber:Destroy() end
                if char:FindFirstChild("EnemyBillboard") then char.EnemyBillboard:Destroy() end
                if char:FindFirstChild("EnemyHighlight") then char.EnemyHighlight:Destroy() end
            end)
        end
    end

    if player.Character then
        onChar(player.Character)
    end
    player.CharacterAdded:Connect(onChar)
end

-- Listen for players
for _,p in pairs(Players:GetPlayers()) do
    applyPlayer(p)
end

Players.PlayerAdded:Connect(function(p)
    applyPlayer(p)
end)

-- Toggle Buttons
espBtn.MouseButton1Click:Connect(function()
    ESP_ENABLED = not ESP_ENABLED
    toggleButton(espBtn, ESP_ENABLED, "player ESP")
end)
aimBtn.MouseButton1Click:Connect(function()
    AIM_ENABLED = not AIM_ENABLED
    toggleButton(aimBtn, AIM_ENABLED, "aimbot")
end)
healthBtn.MouseButton1Click:Connect(function()
    HEALTH_ENABLED = not HEALTH_ENABLED
    toggleButton(healthBtn, HEALTH_ENABLED, "health viewer")
end)

-- ===== Aimbot: follow nearest player =====
spawn(function()
    while true do
        if AIM_ENABLED then
            local closest, dist = nil, math.huge
            local myChar = LocalPlayer.Character
            if myChar then
                local myHRP = myChar:FindFirstChild("HumanoidRootPart")
                if myHRP then
                    for _,p in pairs(Players:GetPlayers()) do
                        if p ~= LocalPlayer and p.Character then
                            local hrp = p.Character:FindFirstChild("HumanoidRootPart")
                            local humanoid = p.Character:FindFirstChildOfClass("Humanoid")
                            if hrp and humanoid and humanoid.Health>0 then
                                local d = (hrp.Position - myHRP.Position).Magnitude
                                if d < dist then
                                    closest = p
                                    dist = d
                                end
                            end
                        end
                    end
                end
            end
            if closest and closest.Character then
                local hum = closest.Character:FindFirstChildOfClass("Humanoid")
                if hum then
                    Camera.CameraType = Enum.CameraType.Custom
                    Camera.CameraSubject = hum
                end
            end
        else
            local myChar = LocalPlayer.Character
            if myChar then
                Camera.CameraType = Enum.CameraType.Custom
                Camera.CameraSubject = myChar:FindFirstChildOfClass("Humanoid")
            end
        end
        wait(0.5)
    end
end)
