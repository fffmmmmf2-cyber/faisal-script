--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

--// Variables
local targetPartName = "HumanoidRootPart" -- Ø§ÙØªØ±Ø§Ø¶ÙŠ
local trackingEnabled = false

--// GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 200, 0, 100)
MainFrame.Position = UDim2.new(0.3, 0, 0.3, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

-- Ø§Ù„Ø®Ø§Ù†Ø© 1: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ø²Ø¡
local PartDropdown = Instance.new("TextButton")
PartDropdown.Size = UDim2.new(0, 180, 0, 30)
PartDropdown.Position = UDim2.new(0, 10, 0, 10)
PartDropdown.Text = "Ø§Ø®ØªØ± Ø§Ù„Ø¬Ø²Ø¡"
PartDropdown.BackgroundColor3 = Color3.fromRGB(255,0,0)
PartDropdown.TextColor3 = Color3.new(1,1,1)
PartDropdown.Parent = MainFrame

local PartOptions = {"Head", "HumanoidRootPart", "UpperTorso", "LowerTorso"}
local PartSelected = "HumanoidRootPart"

PartDropdown.MouseButton1Click:Connect(function()
    PartSelected = PartOptions[(table.find(PartOptions, PartSelected) % #PartOptions) + 1]
    PartDropdown.Text = PartSelected
end)

-- Ø§Ù„Ø®Ø§Ù†Ø© 2: ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØªØ¨Ø¹
local TrackToggle = Instance.new("TextButton")
TrackToggle.Size = UDim2.new(0, 180, 0, 30)
TrackToggle.Position = UDim2.new(0, 10, 0, 50)
TrackToggle.Text = "ØªØªØ¨Ø¹ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§"
TrackToggle.BackgroundColor3 = Color3.fromRGB(255,0,0)
TrackToggle.TextColor3 = Color3.new(1,1,1)
TrackToggle.Parent = MainFrame

TrackToggle.MouseButton1Click:Connect(function()
    trackingEnabled = not trackingEnabled
    if trackingEnabled then
        TrackToggle.BackgroundColor3 = Color3.fromRGB(0,255,0)
    else
        TrackToggle.BackgroundColor3 = Color3.fromRGB(255,0,0)
    end
end)

-- Ø²Ø± Ø±ÙŠÙ†Ø¨Ùˆ Ù„Ø¥Ø®ÙØ§Ø¡ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
local RainbowButton = Instance.new("TextButton")
RainbowButton.Size = UDim2.new(0, 50, 0, 30)
RainbowButton.Position = UDim2.new(0, 10, 0, 10)
RainbowButton.Text = "ğŸŒˆ"
RainbowButton.BackgroundColor3 = Color3.fromRGB(255,0,255)
RainbowButton.TextColor3 = Color3.new(1,1,1)
RainbowButton.Parent = ScreenGui

RainbowButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- Function: Get closest player
local function getClosestPlayer()
    local closest = nil
    local shortestDistance = math.huge
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(PartSelected) then
            local part = player.Character[PartSelected]
            local distance = (part.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                closest = player
            end
        end
    end
    return closest
end

-- Function: Check if part is visible
local function isVisible(part)
    local origin = Camera.CFrame.Position
    local direction = (part.Position - origin).Unit * (part.Position - origin).Magnitude
    local ray = Ray.new(origin, direction)
    local hit = workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character})
    if hit and hit:IsDescendantOf(part.Parent) then
        return true
    else
        return false
    end
end

-- Update Loop
RunService.RenderStepped:Connect(function()
    if trackingEnabled then
        local targetPlayer = getClosestPlayer()
        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild(PartSelected) then
            local part = targetPlayer.Character[PartSelected]
            
            -- Check visibility
            if isVisible(part) then
                -- Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ø´ÙØ§Ù Ø¥Ø°Ø§ Ø¸Ø§Ù‡Ø±
                for _, p in pairs(targetPlayer.Character:GetDescendants()) do
                    if p:IsA("BasePart") then
                        p.Color = Color3.fromRGB(0,255,0)
                        p.Transparency = 0.3
                    end
                end
                Camera.CFrame = CFrame.new(Camera.CFrame.Position, part.Position)
            else
                -- Ù„Ùˆ ØºÙŠØ± Ø¸Ø§Ù‡Ø±ØŒ ÙŠØ±Ø¬Ø¹ Ù„ÙˆÙ† Ø·Ø¨ÙŠØ¹ÙŠ
                for _, p in pairs(targetPlayer.Character:GetDescendants()) do
                    if p:IsA("BasePart") then
                        p.Color = p.Color -- ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù„ÙˆÙ†Ù‡ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
                        p.Transparency = 0
                    end
                end
            end
        end
    end
end)
