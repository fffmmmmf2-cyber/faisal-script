-- EnhancedAimBot.lua
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- إعدادات
local settings = {
    TargetPart = "Head", -- "Head" أو "HumanoidRootPart"
    Smoothness = 0.2,
    CircleSize = 100,
    CircleTransparency = 0.5,
    CircleColor = Color3.fromRGB(100, 180, 255),
}

-- GUI
local gui = Instance.new("ScreenGui")
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- زر التفعيل
local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 100, 0, 40)
button.Position = UDim2.new(0.5, -50, 0, 10)
button.BackgroundColor3 = Color3.fromRGB(100, 180, 255)
button.TextColor3 = Color3.new(1, 1, 1)
button.Text = "تفعيل"
button.Font = Enum.Font.SourceSansBold
button.TextScaled = true
button.AutoButtonColor = true
button.BackgroundTransparency = 0.2
button.BorderSizePixel = 0
button.Parent = gui

local bCorner = Instance.new("UICorner")
bCorner.CornerRadius = UDim.new(0, 8)
bCorner.Parent = button

-- دائرة الهدف
local targetCircle = Instance.new("Frame")
targetCircle.Size = UDim2.new(0, settings.CircleSize, 0, settings.CircleSize)
targetCircle.AnchorPoint = Vector2.new(0.5, 0.5)
targetCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
targetCircle.BackgroundTransparency = settings.CircleTransparency
targetCircle.BackgroundColor3 = settings.CircleColor
targetCircle.BorderSizePixel = 4
targetCircle.BorderColor3 = settings.CircleColor
targetCircle.Visible = false
targetCircle.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0.5, 0)
corner.Parent = targetCircle

-- متغيرات
local enabled = false

button.MouseButton1Click:Connect(function()
    enabled = not enabled
    button.Text = enabled and "إيقاف" or "تفعيل"
    targetCircle.Visible = enabled
end)

-- دالة لإيجاد أقرب لاعب
local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = math.huge
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild(settings.TargetPart) then
            local part = plr.Character[settings.TargetPart]
            local screenPos, onScreen = camera:WorldToViewportPoint(part.Position)
            if onScreen then
                local centerX = camera.ViewportSize.X / 2
                local centerY = camera.ViewportSize.Y / 2
                local dx = screenPos.X - centerX
                local dy = screenPos.Y - centerY
                local distance = math.sqrt(dx*dx + dy*dy)
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestPlayer = plr
                end
            end
        end
    end
    return closestPlayer
end

-- تحديث كل فريم
RunService.RenderStepped:Connect(function(delta)
    if enabled then
        local target = getClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild(settings.TargetPart) then
            local partPos = target.Character[settings.TargetPart].Position
            -- تحديث الكاميرا
            local camPos = camera.CFrame.Position
            local desiredCFrame = CFrame.new(camPos, partPos)
            camera.CameraType = Enum.CameraType.Scriptable
            camera.CFrame = camera.CFrame:Lerp(desiredCFrame, settings.Smoothness)
            -- تحديث الدائرة على الشاشة
            local screenPos, onScreen = camera:WorldToViewportPoint(partPos)
            if onScreen then
                targetCircle.Position = UDim2.new(0, screenPos.X, 0, screenPos.Y)
            else
                targetCircle.Visible = false
            end
        else
            targetCircle.Visible = false
        end
    else
        camera.CameraType = Enum.CameraType.Custom
    end
end)
