-- CameraLockUI.lua
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- GUI
local gui = Instance.new("ScreenGui")
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- المربع (وسط الشاشة)
local square = Instance.new("Frame")
square.Size = UDim2.new(0, 250, 0, 250)
square.Position = UDim2.new(0.5, -125, 0.5, -125)
square.BackgroundTransparency = 0.3 -- شفاف 30% فقط (أوضح)
square.BackgroundColor3 = Color3.fromRGB(100, 180, 255) -- أزرق فاتح
square.BorderSizePixel = 4
square.BorderColor3 = Color3.fromRGB(100, 180, 255)
square.Parent = gui

-- تدوير الزوايا
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = square

-- الزر
local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 80, 0, 30)
button.Position = UDim2.new(0.5, -40, 0, 20) -- أعلى منتصف الشاشة
button.BackgroundColor3 = Color3.fromRGB(100, 180, 255)
button.TextColor3 = Color3.new(1, 1, 1)
button.Text = "تفعيل"
button.Font = Enum.Font.SourceSansBold
button.TextScaled = true
button.AutoButtonColor = true
button.BackgroundTransparency = 0.2
button.BorderSizePixel = 0
button.Parent = gui

local bCorner = Instance.new("UICorner")
bCorner.CornerRadius = UDim.new(0, 8)
bCorner.Parent = button

-- متغيرات
local enabled = false
local targetPlayer = nil

-- تبديل الزر
button.MouseButton1Click:Connect(function()
	enabled = not enabled
	button.Text = enabled and "إيقاف" or "تفعيل"
	if not enabled then
		targetPlayer = nil
		if player.Character and player.Character:FindFirstChild("Humanoid") then
			camera.CameraSubject = player.Character.Humanoid
		end
	end
end)

-- هل داخل المربع؟
local function isInsideSquare(worldPos)
	local screenPos, onScreen = camera:WorldToViewportPoint(worldPos)
	if not onScreen then return false end

	local absPos = square.AbsolutePosition
	local absSize = square.AbsoluteSize

	return screenPos.X >= absPos.X 
	   and screenPos.X <= absPos.X + absSize.X
	   and screenPos.Y >= absPos.Y 
	   and screenPos.Y <= absPos.Y + absSize.Y
end

-- التحديث كل فريم
RunService.RenderStepped:Connect(function()
	if enabled then
		targetPlayer = nil
		for _, plr in ipairs(Players:GetPlayers()) do
			if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local hrp = plr.Character.HumanoidRootPart
				if isInsideSquare(hrp.Position) then
					targetPlayer = plr
					break
				end
			end
		end

		if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("Humanoid") then
			camera.CameraSubject = targetPlayer.Character.Humanoid
		elseif player.Character and player.Character:FindFirstChild("Humanoid") then
			camera.CameraSubject = player.Character.Humanoid
		end
	end
end)
