-- CameraLockSquare.lua
-- LocalScript داخل StarterPlayerScripts

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

-- المربع الأزرق المفرغ
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 250, 0, 250) -- حجم المربع
frame.Position = UDim2.new(0.5, -125, 0.5, -125) -- وسط الشاشة
frame.BackgroundTransparency = 1
frame.BorderSizePixel = 4
frame.BorderColor3 = Color3.fromRGB(100, 180, 255) -- أزرق فاتح
frame.Parent = screenGui

-- زر التفعيل/الإيقاف
local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 80, 0, 30)
button.Position = UDim2.new(0.5, -40, 0, 20) -- فوق وسط الشاشة
button.BackgroundColor3 = Color3.fromRGB(100, 180, 255)
button.TextColor3 = Color3.new(1, 1, 1)
button.Text = "تفعيل"
button.Parent = screenGui
button.AutoButtonColor = true
button.BackgroundTransparency = 0.2
button.Font = Enum.Font.SourceSansBold
button.TextScaled = true
button.ZIndex = 2
button.BorderSizePixel = 0
button.UICorner = Instance.new("UICorner", button)
button.UICorner.CornerRadius = UDim.new(0, 8)

-- متغيرات
local enabled = false
local targetPlayer = nil

-- زر التفعيل
button.MouseButton1Click:Connect(function()
	enabled = not enabled
	button.Text = enabled and "إيقاف" or "تفعيل"
	if not enabled then
		targetPlayer = nil
		camera.CameraSubject = player.Character:WaitForChild("Humanoid")
	end
end)

-- دالة تشيك إذا اللاعب داخل المربع
local function isInSquare(worldPos)
	local screenPos, onScreen = camera:WorldToViewportPoint(worldPos)
	if not onScreen then return false end
	local frameAbsPos = frame.AbsolutePosition
	local frameAbsSize = frame.AbsoluteSize
	return screenPos.X >= frameAbsPos.X and screenPos.X <= frameAbsPos.X + frameAbsSize.X
	   and screenPos.Y >= frameAbsPos.Y and screenPos.Y <= frameAbsPos.Y + frameAbsSize.Y
end

-- تحديث الكاميرا
RunService.RenderStepped:Connect(function()
	if enabled then
		targetPlayer = nil
		for _, plr in ipairs(Players:GetPlayers()) do
			if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local hrp = plr.Character.HumanoidRootPart
				if isInSquare(hrp.Position) then
					targetPlayer = plr
					break
				end
			end
		end

		if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("Humanoid") then
			camera.CameraSubject = targetPlayer.Character.Humanoid
		else
			camera.CameraSubject = player.Character:WaitForChild("Humanoid")
		end
	end
end)
