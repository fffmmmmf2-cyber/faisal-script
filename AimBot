-- CameraLockPlayer.lua
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- GUI
local gui = Instance.new("ScreenGui")
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- الدائرة (شفافية 50%)
local circle = Instance.new("Frame")
circle.Size = UDim2.new(0, 250, 0, 250)
circle.Position = UDim2.new(0.5, -125, 0.5, -125)
circle.BackgroundTransparency = 0.5
circle.BackgroundColor3 = Color3.fromRGB(100, 180, 255)
circle.BorderSizePixel = 4
circle.BorderColor3 = Color3.fromRGB(100, 180, 255)
circle.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0.5, 0) -- دائرة كاملة
corner.Parent = circle

-- زر التفعيل
local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 80, 0, 30)
button.Position = UDim2.new(0.5, -40, 0, 10) -- مؤقت نقدر نغيره
button.BackgroundColor3 = Color3.fromRGB(100, 180, 255)
button.TextColor3 = Color3.new(1, 1, 1)
button.Text = "تفعيل"
button.Font = Enum.Font.SourceSansBold
button.TextScaled = true
button.AutoButtonColor = true
button.BackgroundTransparency = 0.2
button.BorderSizePixel = 0
button.Parent = gui

local bCorner = Instance.new("UICorner")
bCorner.CornerRadius = UDim.new(0, 8)
bCorner.Parent = button

-- متغيرات
local enabled = false
local originalCameraType = camera.CameraType
local originalCFrame = camera.CFrame

-- تبديل الزر
button.MouseButton1Click:Connect(function()
	enabled = not enabled
	button.Text = enabled and "إيقاف" or "تفعيل"

	if enabled then
		-- نوقف التحكم باللاعب بالكاميرا ونثبت الكاميرا
		originalCameraType = camera.CameraType
	else
		-- ترجع الكاميرا طبيعي
		camera.CameraType = originalCameraType
		camera.CFrame = originalCFrame
	end
end)

-- هل اللاعب داخل الدائرة؟
local function isInsideCircle(worldPos)
	local screenPos, onScreen = camera:WorldToViewportPoint(worldPos)
	if not onScreen then return false end

	local absPos = circle.AbsolutePosition
	local absSize = circle.AbsoluteSize
	local radius = absSize.X / 2

	local centerX = absPos.X + radius
	local centerY = absPos.Y + radius

	local dx = screenPos.X - centerX
	local dy = screenPos.Y - centerY
	return (dx*dx + dy*dy) <= (radius*radius)
end

-- تحديث الكاميرا كل فريم
RunService.RenderStepped:Connect(function()
	if enabled then
		for _, plr in ipairs(Players:GetPlayers()) do
			if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local hrp = plr.Character.HumanoidRootPart
				if isInsideCircle(hrp.Position) then
					-- تثبيت الكاميرا على اللاعب
					local camPos = camera.CFrame.Position
					local targetPos = hrp.Position
					camera.CameraType = Enum.CameraType.Scriptable
					camera.CFrame = CFrame.new(camPos, targetPos)
					break
				end
			end
		end
	end
end)
