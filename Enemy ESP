-- خدمات
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- إنشاء واجهة المستخدم
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AnimuGUI"
screenGui.ResetOnSpawn = false -- <<< الإضافة (عشان ما يختفي بعد الموت)
screenGui.Parent = Player:WaitForChild("PlayerGui")

-- الفريم الرئيسي
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 120)
frame.Position = UDim2.new(0.5, -100, 0.5, -60)
frame.BackgroundColor3 = Color3.fromRGB(50,50,50)
frame.BackgroundTransparency = 0.3
frame.Parent = screenGui
frame.Active = true
frame.Draggable = true

-- زر الرينبو لإظهار/إخفاء الفريم
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 20, 0, 20)
toggleBtn.Position = UDim2.new(0, 0, 0, 0)
toggleBtn.Text = "+"
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.BackgroundColor3 = Color3.fromRGB(255,0,0)
toggleBtn.Parent = screenGui

-- تحديث لون الزر بشكل رينبو
spawn(function()
    while true do
        for i = 0, 1, 0.01 do
            toggleBtn.BackgroundColor3 = Color3.fromHSV(i,1,1)
            wait(0.03)
        end
    end
end)

-- وظيفة إخفاء/إظهار الفريم
toggleBtn.MouseButton1Click:Connect(function()
    frame.Visible = not frame.Visible
end)

-- الخانة 1: Enemy ESP
local button1 = Instance.new("TextButton")
button1.Size = UDim2.new(0, 180, 0, 40)
button1.Position = UDim2.new(0, 10, 0, 10)
button1.Text = "Enemy ESP"
button1.TextColor3 = Color3.fromRGB(255,255,255)
button1.BackgroundColor3 = Color3.fromRGB(255,0,0)
button1.Parent = frame

-- الخانة 2: NoClip
local button2 = Instance.new("TextButton")
button2.Size = UDim2.new(0, 180, 0, 40)
button2.Position = UDim2.new(0, 10, 0, 60)
button2.Text = "NoClip"
button2.TextColor3 = Color3.fromRGB(255,255,255)
button2.BackgroundColor3 = Color3.fromRGB(0,0,255)
button2.Parent = frame

-- سكربت Enemy ESP كامل
local enemyESPScript = [[
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local function createHealthGui(player, humanoid)
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp or not humanoid then return end
    local old = player.Character:FindFirstChild("EnemyBillboard")
    if old then old:Destroy() end

    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = hrp
    billboard.Size = UDim2.new(0,150,0,40)
    billboard.StudsOffset = Vector3.new(0,4,0)
    billboard.AlwaysOnTop = true
    billboard.Name = "EnemyBillboard"
    billboard.Parent = player.Character

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1,0,0.5,0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.TextColor3 = Color3.fromRGB(255,0,0)
    nameLabel.TextScaled = true
    nameLabel.Parent = billboard

    local healthBar = Instance.new("Frame")
    healthBar.Size = UDim2.new(humanoid.Health/humanoid.MaxHealth,0,0.3,0)
    healthBar.Position = UDim2.new(0,0,0.6,0)
    healthBar.BackgroundColor3 = Color3.fromRGB(0,255,0)
    healthBar.Parent = billboard

    humanoid:GetPropertyChangedSignal("Health"):Connect(function()
        healthBar.Size = UDim2.new(humanoid.Health/humanoid.MaxHealth,0,0.3,0)
    end)
end

local function applyEnemyEffect(player)
    if player == Players.LocalPlayer then return end
    local function onCharacter(char)
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        if not humanoid then return end

        if char:FindFirstChild("EnemyHighlight") then
            char.EnemyHighlight:Destroy()
        end

        local highlight = Instance.new("Highlight")
        highlight.Name = "EnemyHighlight"
        highlight.Adornee = char
        highlight.FillColor = Color3.fromRGB(255,0,0)
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.Parent = char

        createHealthGui(player, humanoid)
    end

    if player.Character then
        onCharacter(player.Character)
    end
    player.CharacterAdded:Connect(onCharacter)
end

for _, player in pairs(Players:GetPlayers()) do
    applyEnemyEffect(player)
end

Players.PlayerAdded:Connect(applyEnemyEffect)
]]

button1.MouseButton1Click:Connect(function()
    loadstring(enemyESPScript)()
end)

-- NoClip
button2.MouseButton1Click:Connect(function()
    loadstring(game:HttpGet(
        "https://raw.githubusercontent.com/fffmmmmf2-cyber/faisal-script/refs/heads/main/NoClip"
    ))()
end)

-- ===========================================
-- نظام حماية من السقوط
-- ===========================================
local lastSafeCFrame = nil
local fallTime = 0
local maxFallTime = 1.3

RunService.Heartbeat:Connect(function(delta)
    if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") and Player.Character:FindFirstChildOfClass("Humanoid") then
        local hrp = Player.Character.HumanoidRootPart
        local humanoid = Player.Character:FindFirstChildOfClass("Humanoid")

        if humanoid.FloorMaterial ~= Enum.Material.Air then
            lastSafeCFrame = hrp.CFrame
            fallTime = 0
        else
            fallTime = fallTime + delta
            if fallTime >= maxFallTime and lastSafeCFrame then
                hrp.CFrame = lastSafeCFrame

                local platform = Instance.new("Part")
                platform.Size = Vector3.new(3, 1, 3)
                platform.Anchored = true
                platform.CanCollide = true
                platform.Position = hrp.Position - Vector3.new(0, hrp.Size.Y/2 + 0.5, 0)
                platform.Transparency = 0.5
                platform.BrickColor = BrickColor.new("Really black")
                platform.Parent = workspace

                fallTime = 0
            end
        end
    end
end)

-- ===============================
-- إعادة تهيئة بعد الموت (إضافة فقط)
-- ===============================
local function onCharacterAdded(char)
    lastSafeCFrame = nil
    fallTime = 0
end

if Player.Character then
    onCharacterAdded(Player.Character)
end

Player.CharacterAdded:Connect(onCharacterAdded)
