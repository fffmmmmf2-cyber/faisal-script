-- NoClip كامل مع حماية من السقوط
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer

-- حالة النوكليب
local noclipEnabled = true

-- دالة لضبط التصادم
local function setCharacterCollision(char, value)
    if not char then return end
    for _, part in pairs(char:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = value
        end
    end
end

-- دالة لحماية السقوط تحت الأرض
local function protectFall(char)
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if hrp and humanoid then
        local rayParams = RaycastParams.new()
        rayParams.FilterDescendantsInstances = {char}
        rayParams.FilterType = Enum.RaycastFilterType.Blacklist
        rayParams.IgnoreWater = true
        local ray = Workspace:Raycast(hrp.Position, Vector3.new(0,-1000,0), rayParams)
        if ray and ray.Position.Y > hrp.Position.Y then
            hrp.CFrame = CFrame.new(hrp.Position.X, ray.Position.Y + humanoid.HipHeight + 0.5, hrp.Position.Z)
        end
    end
end

-- اللوب الرئيسي للنوكليب
RunService.RenderStepped:Connect(function()
    if not noclipEnabled then return end
    local char = player.Character
    if char then
        -- تعطيل التصادم لكل أجزاء الشخصية
        setCharacterCollision(char, false)
        -- حماية من السقوط تحت الأرض
        protectFall(char)
    end
end)

print("[NoClip] loaded - فعال، يخترق الجدران ويحميك من السقوط تحت الأرض")
