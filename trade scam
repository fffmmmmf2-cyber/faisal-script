-- LocalScript
local player = game.Players.LocalPlayer
local runService = game:GetService("RunService")
local workspace = game:GetService("Workspace")

local radius = 40 -- الآن 40 ستود
local updateInterval = 0.1
local labels = {}

local ignoreParts = {
    "Head", "Torso", "HumanoidRootPart",
    "LeftHand", "RightHand", "LeftFoot", "RightFoot",
    "LeftLowerArm", "RightLowerArm", "LeftLowerLeg", "RightLowerLeg",
    "LeftUpperArm", "RightUpperArm", "LeftUpperLeg", "RightUpperLeg",
    "UpperTorso", "LowerTorso",
}

local function isIgnored(part)
    for _, name in pairs(ignoreParts) do
        if part.Name == name then
            return true
        end
    end
    return false
end

local function createLabel(part)
    if labels[part] then return labels[part] end

    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = part
    billboard.Size = UDim2.new(0, 100, 0, 20)
    billboard.StudsOffset = Vector3.new(0, 2, 0)
    billboard.AlwaysOnTop = true

    local textLabel = Instance.new("TextLabel")
    textLabel.Parent = billboard
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.new(1,1,1)
    textLabel.TextScaled = true
    textLabel.Font = Enum.Font.SourceSans
    textLabel.Text = part.Name

    billboard.Parent = player.PlayerGui
    labels[part] = billboard
    return billboard
end

local function updateLabels()
    local character = player.Character
    if not character then return end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local nearbyParts = {}

    for _, part in pairs(workspace:GetDescendants()) do
        if part:IsA("BasePart") and not isIgnored(part) then
            local distance = (part.Position - hrp.Position).Magnitude
            if distance <= radius then
                nearbyParts[part] = true
                createLabel(part)
            end
        end
    end

    for part, billboard in pairs(labels) do
        if not nearbyParts[part] then
            billboard:Destroy()
            labels[part] = nil
        end
    end
end

runService.RenderStepped:Connect(function()
    updateLabels()
end)
